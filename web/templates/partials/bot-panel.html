<header class="h-16 bg-white border-b border-gray-200 flex items-center px-6 justify-between flex-shrink-0">
  <div class="flex items-center">
    <button id="sidebar-toggle" class="md:hidden mr-3 p-2 rounded-md hover:bg-gray-100">
      <i data-lucide="menu" class="w-6 h-6 text-gray-700"></i>
    </button>
    <h1 class="text-lg sm:text-xl font-bold text-gray-800">Painel de Controle</h1>
  </div>
  <div class="flex items-center space-x-4">
    <button class="p-2 rounded-full hover:bg-gray-100">
      <i data-lucide="bell" class="w-5 h-5 text-gray-600"></i>
    </button>
    <img src="https://placehold.co/40x40/E2E8F0/475569?text=U" class="w-10 h-10 rounded-full" alt="User Avatar">
  </div>
</header>

<!-- Tab Navigation (Config and Analysis only) -->
<div class="px-6 bg-white border-b border-gray-200 flex-shrink-0 overflow-x-auto">
  <nav class="flex space-x-8">
    <button class="tab-button py-4 text-gray-500 border-b-2 border-transparent transition-all tab-active whitespace-nowrap"
      data-tab="configuracao">Configuração</button>
    <button class="tab-button py-4 text-gray-500 border-b-2 border-transparent transition-all whitespace-nowrap"
      data-tab="analises">Análises</button>
  </nav>
</div>

<!-- Tab Content -->
<div id="tab-content" class="p-4 sm:p-6 flex-1 overflow-y-auto">
  <!-- Config Tab (default) -->
  <div id="configuracao" class="tab-content">
    {{ template "panel-config.html" . }}
  </div>

  <!-- Analysis Tab -->
  <div id="analises" class="tab-content hidden h-full">
    {{ template "panel-analysis.html" . }}
  </div>
</div>

<script>
  document.addEventListener("htmx:afterSwap", function(evt) {
    if (evt.detail.target.id === "main-content") {
      lucide.createIcons();

      let selectedInstanceName = "Bot Principal"; // Assume single instance

      // Update titles
      document.querySelector('#config-title span').textContent = selectedInstanceName;
      document.querySelector('#analysis-title span').textContent = selectedInstanceName;

      // Show contents
      document.getElementById('config-placeholder').classList.add('hidden');
      document.getElementById('config-content').classList.remove('hidden');
      document.getElementById('analysis-placeholder').classList.add('hidden');
      document.getElementById('analysis-content').classList.remove('hidden');

      const tabButtons = document.querySelectorAll('.tab-button');
      const tabContents = document.querySelectorAll('.tab-content');

      // Initial state
      tabButtons.forEach(btn => btn.classList.remove('tab-active'));
      document.querySelector('[data-tab="configuracao"]').classList.add('tab-active');
      tabContents.forEach(content => content.classList.add('hidden'));
      document.getElementById('configuracao').classList.remove('hidden');

      tabButtons.forEach(button => {
        button.addEventListener('click', () => {
          const tabName = button.dataset.tab;

          tabButtons.forEach(btn => btn.classList.remove('tab-active'));
          button.classList.add('tab-active');

          tabContents.forEach(content => {
            content.classList.toggle('hidden', content.id !== tabName);
          });
        });
      });

      // Bot Configuration Logic
      const addKeywordBtn = document.getElementById('add-keyword-btn');
      const keywordContainer = document.getElementById('keyword-responses-container');

      if (addKeywordBtn && keywordContainer) {
        addKeywordBtn.addEventListener('click', () => {
          const newRow = document.createElement('div');
          newRow.className = "flex flex-col sm:flex-row sm:items-start sm:space-x-4 space-y-4 sm:space-y-0 p-4 bg-gray-50 rounded-lg border";
          newRow.innerHTML = `
                <div class="w-full sm:w-1/3"><label class="text-sm font-medium text-gray-600">Se o usuário enviar...</label><input type="text" class="w-full mt-1 border-gray-300 rounded-md focus:ring-emerald-500 focus:border-emerald-500" placeholder="Ex: promoção"></div>
                <div class="w-full sm:w-2/3"><label class="text-sm font-medium text-gray-600">O bot responde...</label><textarea rows="2" class="w-full mt-1 border-gray-300 rounded-md focus:ring-emerald-500 focus:border-emerald-500" placeholder="Digite a resposta do bot"></textarea></div>
                <button class="remove-keyword-btn text-gray-400 hover:text-red-500 pt-1 sm:pt-7 self-end sm:self-start"><i data-lucide="trash-2" class="w-5 h-5"></i></button>`;
          keywordContainer.appendChild(newRow);
          lucide.createIcons();
        });

        keywordContainer.addEventListener('click', (event) => {
          if (event.target.closest('.remove-keyword-btn')) {
            event.target.closest('.remove-keyword-btn').parentElement.remove();
          }
        });
      }

      // Analysis Tab Mobile View Logic
      const chatListPanel = document.getElementById('chat-list-panel');
      const conversationPanel = document.getElementById('conversation-panel');
      const chatItems = document.querySelectorAll('.chat-item');
      const backToChatsBtn = document.getElementById('back-to-chats');

      function showConversation() {
        if (window.innerWidth < 768) {
          chatListPanel.classList.add('-translate-x-full');
          conversationPanel.classList.remove('translate-x-full');
        }
      }

      function showChatList() {
        if (window.innerWidth < 768) {
          chatListPanel.classList.remove('-translate-x-full');
          conversationPanel.classList.add('translate-x-full');
        }
      }

      if (chatItems.length > 0) {
        chatItems.forEach(item => item.addEventListener('click', showConversation));
      }
      if (backToChatsBtn) {
        backToChatsBtn.addEventListener('click', showChatList);
      }
    }
  });
</script>