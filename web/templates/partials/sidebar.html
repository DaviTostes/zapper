<div class="h-16 flex items-center justify-between border-b border-gray-200 px-4">
  <a href="#" class="flex items-center space-x-2">
    <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-emerald-500">
      <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon>
    </svg>
    <span class="font-bold text-2xl text-gray-800">Zapper</span>
  </a>
  <button id="mobile-sidebar-close"
    class="md:hidden p-2 rounded-md hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-2">
    <i data-lucide="x" class="w-6 h-6 text-gray-600"></i>
  </button>
</div>
<nav class="flex-1 p-4 space-y-2">
  <a href="#" class="flex items-center px-4 py-2.5 text-gray-700 bg-emerald-50 rounded-lg font-semibold">
    <i data-lucide="layout-dashboard" class="w-5 h-5 mr-3 text-emerald-500"></i>
    Painel
  </a>
  <a href="#" class="flex items-center px-4 py-2.5 text-gray-600 hover:bg-gray-50 rounded-lg">
    <i data-lucide="settings" class="w-5 h-5 mr-3"></i>
    Configurações
  </a>
  <a href="#" class="flex items-center px-4 py-2.5 text-gray-600 hover:bg-gray-50 rounded-lg">
    <i data-lucide="user-circle" class="w-5 h-5 mr-3"></i>
    Minha Conta
  </a>
  <a href="#" class="flex items-center px-4 py-2.5 text-gray-600 hover:bg-gray-50 rounded-lg">
    <i data-lucide="life-buoy" class="w-5 h-5 mr-3"></i>
    Suporte
  </a>
</nav>
<div class="p-4 border-t border-gray-200">
  <a href="#" class="flex items-center px-4 py-2.5 text-gray-600 hover:bg-gray-50 rounded-lg">
    <i data-lucide="log-out" class="w-5 h-5 mr-3"></i>
    Sair
  </a>
</div>

<script>
  // Mobile Sidebar Logic - All contained in sidebar.html with event delegation for reliability
  function setupMobileSidebar() {
    const sidebar = document.getElementById('sidebar');
    let overlay = document.getElementById('sidebar-overlay');
    let mobileHeader = document.getElementById('mobile-header');

    // Create overlay if not exists
    if (!overlay) {
      overlay = document.createElement('div');
      overlay.id = 'sidebar-overlay';
      overlay.className = 'fixed inset-0 bg-black bg-opacity-50 z-30 hidden md:hidden';
      document.body.appendChild(overlay);
    }

    // Create mobile header if not exists
    if (!mobileHeader) {
      mobileHeader = document.createElement('div');
      mobileHeader.id = 'mobile-header';
      mobileHeader.className = 'md:hidden bg-white border-b border-gray-200 p-4 flex items-center justify-between z-50 fixed top-0 left-0 right-0';
      mobileHeader.innerHTML = `
        <button id="mobile-menu-button" class="p-2 rounded-md hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-emerald-500">
          <i data-lucide="menu" class="w-6 h-6 text-gray-600"></i>
        </button>
        <h1 class="text-lg font-semibold text-gray-800">Zapper</h1>
        <div class="w-6"></div>
      `;
      document.body.insertBefore(mobileHeader, document.body.firstChild);
      lucide.createIcons();
    }

    // Show/hide mobile header based on screen size
    if (window.innerWidth < 768) {
      mobileHeader.style.display = 'flex';
    } else {
      mobileHeader.style.display = 'none';
    }

    // Remove old listeners to prevent duplicates
    const oldOpenBtn = document.getElementById('mobile-menu-button');
    if (oldOpenBtn) oldOpenBtn.removeEventListener('click', openSidebar);
    const oldCloseBtn = document.getElementById('mobile-sidebar-close');
    if (oldCloseBtn) oldCloseBtn.removeEventListener('click', closeSidebar);

    // Direct event listeners (re-attach)
    const mobileMenuButton = document.getElementById('mobile-menu-button');
    if (mobileMenuButton) {
      mobileMenuButton.addEventListener('click', openSidebar);
    }

    const mobileCloseButton = document.getElementById('mobile-sidebar-close');
    if (mobileCloseButton) {
      mobileCloseButton.addEventListener('click', closeSidebar);
    }

    // Overlay listener (re-attach)
    if (overlay) {
      overlay.removeEventListener('click', closeSidebar);
      overlay.addEventListener('click', closeSidebar);
    }

    // Define functions for clarity
    function openSidebar(e) {
      if (e) e.preventDefault();
      if (sidebar) sidebar.classList.remove('-translate-x-full');
      if (overlay) overlay.classList.remove('hidden');
    }

    function closeSidebar(e) {
      if (e) e.preventDefault();
      if (sidebar) sidebar.classList.add('-translate-x-full');
      if (overlay) overlay.classList.add('hidden');
    }

    // Resize handler
    function handleResize() {
      if (window.innerWidth >= 768) {
        if (sidebar) sidebar.classList.remove('-translate-x-full');
        if (overlay) overlay.classList.add('hidden');
        if (mobileHeader) mobileHeader.style.display = 'none';
      } else {
        if (sidebar) sidebar.classList.add('-translate-x-full');
        if (overlay) overlay.classList.add('hidden');
        if (mobileHeader) mobileHeader.style.display = 'flex';
      }
    }

    // Remove old resize listener if exists
    window.removeEventListener('resize', window.mobileSidebarResizeHandler);
    window.addEventListener('resize', handleResize);
    window.mobileSidebarResizeHandler = handleResize;

    // Ensure initial state
    handleResize();

    // Initialize icons
    if (typeof lucide !== 'undefined') lucide.createIcons();
  }

  // Run setup
  if (document.readyState === 'complete' || document.readyState === 'interactive') {
    setupMobileSidebar();
  } else {
    document.addEventListener('DOMContentLoaded', setupMobileSidebar);
  }

  // HTMX integration
  if (typeof htmx !== 'undefined') {
    htmx.on('htmx:afterRequest', function (evt) {
      if (evt.target.id === 'sidebar' || evt.detail.target && evt.detail.target.id === 'sidebar') {
        setTimeout(setupMobileSidebar, 100); // Delay to ensure DOM update
      }
    });
  }
</script>
